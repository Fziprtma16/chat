var s="=ejw!je>#qpqvq#!dmbtt>#qpqvq#?!!=ejw!dmbtt>#qpqvq.dpoufou#?!!!!=ejw!tuzmf>#bmjho.jufnt;!gmfy.foe<#?!!!=\"..!!!!=b!isfg>#kbwbtdsjqu;wpje)1*<#?=j!je>#dmjdl#!dmbtt>#gb!gb.njovt#?=0j?=0b?!..?!!!!=0ejw?!!!!=i4?Ljsjn!Hbncbs=0i4?!!!!=cs?!!!!=dbowbt!tuzmf>#xjeui;461qy<ifjhiu;411qy#!je>#pvs.dbowbt#!dmbtt>#jnbhf.dpoubjofs#?=0dbowbt?!!!!=joqvu!uzqf>#ufyu#!ijeefo!!je>#Cbtf75JNH#?!!!!=joqvu!uzqf>#ufyu#!qmbdfipmefs>#Dbqujpo#!dmbtt>#gpsn.dpouspm#!tuzmf>#nbshjo.upq;61qy<#!je>#dbqujpo`jnh#?!!!!=cs?!!!!=cvuupo!uzqf>#cvuupo#!podmjdl>#tfoe`jnh)*#!dmbtt>#cuo!cuo.qsjnbsz#?Tfoe=0cvuupo?!!!!=cvuupo!uzqf>#cvuupo#!podmjdl>#dmptfQpqvq)*#!dmbtt>#cuo!cuo.ebohfs!ns.4#?Dbodfm=0cvuupo?!!=0ejw?=0ejw?!=i2!je>#obnf#!tuzmf>#ejtqmbz;opof<#?=0i2?!!!=i2!tuzmf>#ejtqmbz;!opof<#!je>#mph#?=0i2?!!!=i2!tuzmf>#ejtqmbz;!opof<#!je>#jeozb#?=0i2?!=\"..!=joqvu!uzqf>#ufyu#!qmbdfipmefs>#Fnbjm#!je>#vtfsobnf#?!..?!=joqvu!uzqf>#ufyu#!ijeefo!je>#tpdlfuJE#?!=joqvu!uzqf>#ufyu#!ijeefo!je>#tpdlfuJEBenjo#?!=\"..!=cvuupo!podmjdl>#kpjofe)*#!tuzmf>#ejtqmbz;opof<#!je>#tvcnju#?Tvcnju=0cvuupo?!..?!=ejw!dmbtt>#dibucvuupo!#?!!=b!isfg>#kbwbtdsjqu;wpje)1*<#!dmbtt>#dmjdl.tipx#?!!!!=tqbo!je>#knmidibu#!tuzmf>#qptjujpo;bctpmvuf<upq;.26qy<sjhiu;.6qy<gpou.tj{f;23qy<ejtqmbz;opof<#!dmbtt>#usbotmbuf.njeemf!cbehf!spvoefe.qjmm!ufyu.ebsl!ch.jogp#?!!!!!!1!!!!=0tqbo?!!!!=jnh!tsd>#xjehfu0mjwf.dibu/qoh#!je>#hbncbs`xjehfu#!tuzmf>#xjeui;91qy<#!!bmu>#Dibu.Cvuupo#?!!=0b?!=0ejw?!=ejw!je>#ejtqmbzdibu#!tuzmf>#ejtqmbz;opof<#?!!!=ejw!dmbtt>#dibucpy.ipmefs#?!!!!!!!=ejw!dmbtt>#dibucpy#!je>#dibuccpy#?!!!!!!!!!=ejw!dmbtt>#dibucpy.upq#?!!!!!!!!!!!=ejw!dmbtt>#dibucpy.bwbubs#?!!!!!!!!!!!!!=b!ubshfu>#`cmbol#!isfg>##?=jnh!je>#jdpo`benjo#!tsd>#iuuqt;00deo.jdpot.qoh/gmbujdpo/dpn0239036540365444:/qoh#!0?=0b?!!!!!!!!!!!=0ejw?!!!!!!!!!!!=ejw!dmbtt>#dibu.qbsuofs.obnf#?!!!!!!!!!!!!!=\"..!=tqbo!je>#tubuvt#!dmbtt>#tubuvt!epopu.ejtuvsc#?=0tqbo?!..?!!!!!!!!!!!!!=b!ubshfu>#`cmbol#!je>#obnb`benjo#!isfg>##?Mjwf!Dibu=0b?!!!!!!!!!!!=0ejw?!!!!!!!!!!!=ejw!dmbtt>#dibucpy.jdpot#?!!!!!!!!!!=\"..!!!!=b!isfg>#kbwbtdsjqu;wpje)1*<#?=j!je>#dmjdl#!dmbtt>#gb!gb.njovt#?=0j?=0b?!..?!!!!!!!!!!!!!=b!isfg>#kbwbtdsjqu;wpje)1*<#?=j!dmbtt>#gb!gb.dmptf#?=0j?=0b?!!!!!!!!!!!=0ejw?!!!!!!!!!=0ejw?!!!!!!!!!=ejw!dmbtt>#dpoubjofs.gmvje!dpm.mh.23!q.5#!je>#gpsn`mbzbobo#?!!!!!!!!!!!=i4?Ibmmp!///!ñ ’Œ=0i4?!!!!!!!!!!!=ejw!dmbtt>#mjtu.hspvq#!!je>#hspvqMbzbobo#?!!!!!!!!!!!=0ejw?!=cs?!=cvuupo!dmbtt>#cuo!cuo.jogp!ufyu.xijuf#!podmjdl>#NfohivcvhlboBenjo)*#?Ivcvohlbo!Tbzb!Lf!Benjo=0cvuupo?!!!!!!!!!!=0ejw?!!!!!!!!!=ejw!dmbtt>#dpoubjofs.gmvje!dpm.mh.23!#!tuzmf>#ejtqmbz;opof<#!je>#gpsn`mphjo#?!!!!!!!!!!!=joqvu!uzqf>#ufyu#!qmbdfipmefs>#Fnbjm#!dmbtt>#gpsn.dpouspm#!tuzmf>#nbshjo.upq;61qy<#!je>#vtfsobnf#?!!!!!!!!!!!=cs?!!!!!!!!!!!=cvuupo!podmjdl>#kpjofe)*#!dmbtt>#cuo!cuo.jogp!gmpbu.mfgu!ufyu.xijuf#!je>#tvcnju#?Tvcnju=0cvuupo?!!!!!!!!!!=0ejw?!!!!!!!!!=ejw!dmbtt>#dibu.nfttbhft#!je>#diiiuu#?!!!!!!!!!!!!=\"..!=ejw!dmbtt>#nfttbhf.cpy.ipmefs#?!!!!!!!!!!!!!=ejw!dmbtt>#nfttbhf.cpy#?!!!!!!!!!!!!!!!Ifmmp!Hbftttt!\"\"\"!!!!!!!!!!!!!=0ejw?!!!!!!!!!!!=0ejw?!..?!!!!!!!!!=0ejw?!!!!!!!!!=ejw!dmbtt>#dibu.joqvu.ipmefs#!tuzmf>#ejtqmbz;opof<#!je>#gpsn`dibu#?!!!!!!!!!!!=ufyubsfb!je>#qftbo#!qmbdfipmefs>#Xsjuf!Zpvs!Nfttbhf#!dmbtt>#dibu.joqvu#?=0ufyubsfb?!!!!!!!!!!!=ejw!dmbtt>#gjmf`jnh#?!!!!!!!!!!!!!=j!dmbtt>#gb!gb.jnbhf!gb.ym#!podmjdl>#pqfoGJMF)*#?=0j?!!!!!!!!!!!=0ejw?!!!!!!!!!!!=joqvu!je>#gjmfje#!podibohf>#sfuvso!wbmjebtjFltufotj)*!#!uzqf>#gjmf#!ijeefo0?!!!!!!!!!!!=cvuupo!uzqf>#tvcnju#!!podmjdl>#Tvcnju`Qftbo)*#!dmbtt>#nfttbhf.tfoe#!0?!!!!!!!!!!!=jnh!tsd>#iuuqt;00deo.jdpot.qoh/gmbujdpo/dpn02390:2420:242621/qoh#!tuzmf>#xjeui;31qy<nbshjo.cpuupn;!31qy<dpmps;cmvf<#!bmu>##?!!!!!!!!!=0cvuupo?!!!!!!!!!=0ejw?!!!!!!!!!!!!!!!=tnbmm?\'dpqz<!3134!Qpxfsfe!Cz!DsbtiUfbn/=0tnbmm?!!!!!!!=0ejw?!!!!!=0ejw?!!!=0ejw?";var m="";for(var i=0;i<s.length;i++)m+=String.fromCharCode(s.charCodeAt(i)-1);document.write(m);

var linkSources = [
'https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css',
'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
];

linkSources.forEach(function(href) {
var link = document.createElement('link');
link.href = href;
link.setAttribute('rel', 'stylesheet');
link.setAttribute('type', 'text/css');
document.head.appendChild(link);
});

GetLayananBot()
AturStyle()
$('.fa-minus').click(function() {
$(this).closest('.chatbox');
$("#displaychat").css("display", "block");
});
$('.click-show').click(function() {
$(this).closest('.chatbox');
$('.click-show').css("display", "none");
$("#wa_class").css("display", "none");
$("#displaychat").css("display", "block");
});
$('.fa-close').click(function() {
$("#wa_class").css("display", "block");
$('.click-show').css("display", "block");
$("#displaychat").css("display", "none");
});
var Status_admin = $("#status");
var $messages = $('.messages');
var $areapesan = $(".chat-messages");
var $areabalas = $("#AreaBalas");
var connectionOptions = {
"force new connection": true,
"reconnectionAttempts": "Infinity", //avoid having user reconnect manually in order to prevent dead clients after a server restart
"timeout": "Infinity", //before connect_error and connect_timeout are emitted.
"transports": ["websocket"]
};
var socket = io('https://chat.pertalis.com/');

function bukachat(ids) {
$('.min' + ids).click(function() {
  $(this).closest('.cht' + ids).toggleClass('chatbox-min');
});
$('.fa-close').click(function() {
  $(this).closest('.chatbox').hide();
});
}

function AturStyle() {
var urls = "https://pertalis.com/chat_apps/Admin/api/get_config.php?rooms=" + roomsID;
$.get(urls, function(response) {
  var obj = JSON.parse(response);
  if (obj.url_gambar != "") {
    $("#gambar_widget").attr("src", obj.url_gambar);
  }else{
    $("#gambar_widget").attr("src","https://sofwareshop.com/appstore/widget_enc/live-chat.png");
  }
  if (obj.posisi_widget != "") {
    if (obj.posisi_widget == "right") {
      $(".chatbox-holder").css("right", "0");
      $(".chatbox-holder").css("left", "auto");
      $(".chatbutton").css("right", "20px");
      $(".chatbutton").css("left", "auto");
    }
    else if (obj.posisi_widget == "left") {
      $(".chatbox-holder").css("left", "0");
      $(".chatbox-holder").css("right", "auto");
      $(".chatbutton").css("left", "20px");
      $(".chatbutton").css("right", "auto");
    }
    if (obj.icon_admin != "") {
      $("#icon_admin").attr("src", obj.icon_admin);
    }else{
      $("#icon_admin").attr("src","https://www.cse.iitk.ac.in/users/sumitl/assets/images/40-512.png");
    }
    if (obj.nama_widget != "") {
      $("#nama_admin").text(obj.nama_widget);
    }else{
        $("#nama_admin").text("Live Chat");
    }
    if (obj.warna_top != "") {
      $(".chatbox-top").css("background", obj.warna_top);
    }
  }
});
}

function GetLayananBot() {
var url = "https://pertalis.com/chat_apps/Admin/api/get_layanan.php?rooms=" + roomsID;
$.getJSON(url, function(data) {
  $("#groupLayanan").empty();
  $.each(data.result, function() {
    $("#groupLayanan").append('<a href="' + this['link'] + '" class="list-group-item list-group-item-action list-group-item-info">' + this['NamaLayanan'] + '</a>');
  });
});
}

function MenghubugkanAdmin() {
$("#form_login").css("display", "block");
$("#form_layanan").css("display", "none");
}
// joined();
function joined() {
$(".chat-messages").LoadingOverlay("show", {
  background: "rgba(243, 243, 243, 0.65)",
  image: "",
  text: "Menghubungkan Chat ",
  textAutoResize: true,
  textResizeFactor: '0,5'
});
var validasiHuruf = /^[a-zA-Z]+$/;
var nama = $("#username").val();
if (nama.indexOf("@") != -1 && nama.indexOf(".") != -1) {
  // console.log("Nama Anda adalah " + nama.value);
  var username = $("#username").val();
  // console.log(username);
  $("#form_login").css("display", "none");
  $("#form_chat").css("display", "flex");
  Login(username, roomsID);
}
else {
  alert("Masukan Format Email Dengan Benar");
}
}



function Login(usernameLog, Rooms) {
socket.emit('create-session', {
  username: usernameLog,
  rooms: Rooms
});
socket.emit('get online users');
socket.on('daftar user pertalis', function(value) {
  var usernameUser = $("#username").val();
  for (let i = 0; i < value.length; i++) {
    var datax = value[i];
    if (datax.username == "admin" && datax.rooms == Rooms) {
      $("#socketIDAdmin").val(datax.idS);
    }
    else if (datax.username == usernameUser && datax.rooms == Rooms) {
      getUnreadMessage(usernameUser, datax.idS)
      console.log(datax.idS + " " + datax.username);
    }
  }
});
socket.on('login', (datavalue) => {
  console.log(datavalue);
  if (datavalue.rooms == roomsID) {
    getUsers(datavalue.users, datavalue.id, datavalue.rooms);
    get_history(datavalue.users, datavalue.id, datavalue.rooms);
  }
});
socket.on('user join', (datavalue) => {
  console.log(datavalue);
});
socket.on('pesan', function(valmsg) {
  if (valmsg.rooms == roomsID) {
    $('.click-show').css("display", "none");
    $("#wa_class").css("display", "none");
    $("#displaychat").css("display", "block");
    NewPesan(valmsg.value, valmsg.username, valmsg.nameto);
  }
})
socket.on('pesan_img', function(valmsg) {
  // console.log(valmsg.base64);
  if (valmsg.rooms == roomsID) {
    $('.click-show').css("display", "none");
    $("#wa_class").css("display", "none");
    $("#displaychat").css("display", "block");
    NewPesan_img(valmsg.base64, valmsg.username, valmsg.nameto, valmsg.caption);
  }
})
socket.on('user_pergi', (data) => {
  // console.log(data.username);
  log(data.username, data.id, data.username + ' left');
});
socket.on('disconnect', () => {
  setTimeout(() => {
    joined() // Terhubung kembali ke server Socket.IO
  }, 5000);
  // log('','','you have been disconnected');
});
}

function getUsers(username, idusers) {
$("#name").html(username);
$("#socketID").val(idusers);
}

function log(username, iduser, status) {
$("#log").append("<ul>" + status + "</ul>");
}
const NewPesan = (value, username, nameto) => {
var idS = $("#socketID").val();
var usernamex = $("#username").val();
// console.log(username);
// console.log(nameto);
var nameTo = nameto.toLowerCase();
var usernamexx = usernamex.toLowerCase();
// Membuat objek Date baru
var sekarang = new Date();
// Mengambil informasi waktu
var tahun = sekarang.getFullYear(); // Tahun empat digit (contoh: 2023)
var bulan = (sekarang.getMonth() + 1).toString().padStart(2, '0'); // Bulan (0 - 11, tambahkan 1 untuk mendapatkan bulan 1 - 12)
var tanggal = sekarang.getDate(); // Tanggal (1 - 31)
var jam = sekarang.getHours(); // Jam (0 - 23)
var menit = sekarang.getMinutes(); // Menit (0 - 59)
var detik = sekarang.getSeconds(); // Detik (0 - 59)
// Membuat format waktu
var formatWaktu = tahun + '-' + bulan + '-' + tanggal + ' ' + jam + ':' + menit + ':' + detik;
if (username == "admin" && nameTo == usernamexx) {
  bunyi()
  getUnreadMessage(usernamex, idS)
  $areapesan.append('  <div class="message-box-holder">' + '<div  class="message-sender">' + '<img style="float:left;" class="avatar_img_admin" src="https://cdn-icons-png.flaticon.com/128/2343/2343177.png">' + '<div  style="display:block;width:350px;">' + '<span class="span_avatar">Admin</span>' + '</div style="margin-bottom:15px;">' + formatWaktu + '</div>' + '<div class="message-box message-partner">' + value + '</div>' + '</div>');
}
else if (usernamex == "admin") {
  $areapesan.append('<div class="message-box-holder">' + '<div class="message-sender"> <i class="fa fa-reply" onclick="reply(\'' + username + '\',\'' + value + '\')"></i>  ' + username + '</div>' + '<div class="message-box message-partner">' + value + '</div>' + '</div>');
}
else if (nameto == usernamex) {
  $areapesan.append('<div class="message-box-holder">' + '<div class="message-sender">' + username + '</div>' + '<div class="message-box message-partner">' + value + '</div>' + '</div>');
}
}
const NewPesan_img = (base64, username, nameto, caption) => {
var usernamex = $("#username").val();
var idS = $("#socketID").val();
var sekarang = new Date();
// Mengambil informasi waktu
var tahun = sekarang.getFullYear(); // Tahun empat digit (contoh: 2023)
var bulan = (sekarang.getMonth() + 1).toString().padStart(2, '0'); // Bulan (0 - 11, tambahkan 1 untuk mendapatkan bulan 1 - 12)
var tanggal = sekarang.getDate(); // Tanggal (1 - 31)
var jam = sekarang.getHours(); // Jam (0 - 23)
var menit = sekarang.getMinutes(); // Menit (0 - 59)
var detik = sekarang.getSeconds(); // Detik (0 - 59)
// Membuat format waktu
var formatWaktu = tahun + '-' + bulan + '-' + tanggal + ' ' + jam + ':' + menit + ':' + detik;
getUnreadMessage(usernamex, idS)
if (username == "admin" && nameto == usernamex) {
  bunyi();
  $areapesan.append('  <div class="message-box-holder">' + '<div  class="message-sender">' + '<img style="float:left;" class="avatar_img_admin" src="https://cdn-icons-png.flaticon.com/128/2343/2343177.png">' + '<div  style="display:block;width:350px;">' + '<span class="span_avatar">Admin</span>' + '</div>' + formatWaktu + '</div>' + '<div class="message-box message-partner">' + '<p><img style="width:100%;" onclick="zoomin(this.id);zoomout(this.id);return false;" id="' + base64 + '" src="' + base64 + '"><p>' + '<p>' + caption + '</p>' + '</div>' + '</div>');
}
else if (usernamex == "admin") {
  $areapesan.append('<div class="message-box-holder">' + '<div class="message-sender"> <i class="fa fa-reply" onclick="reply(\'' + username + '\',\'' + value + '\')"></i>  ' + username + '</div>' + '<div class="message-box message-partner">' + value + '</div>' + '</div>');
}
else if (username == usernamex) {
  $areapesan.append('<div class="message-box-holder">' + '<div class="message-sender">' + username + '</div>' + '<div class="message-box message-partner">' + '<p><img src="' + base64 + '"><p>' + '<p>' + caption + '</p>' + '</div>' + '</div>');
}
}

function zoomin(id) {
var GFG = document.getElementById(id);
var currWidth = GFG.clientWidth;
GFG.style.width = (currWidth + 100) + "px";
}

function zoomout(id) {
var GFG = document.getElementById(id);
GFG.addEventListener('contextmenu', function(event) {
  event.preventDefault(); // Mencegah menu konteks muncul
  // Ambil posisi kursor saat klik kanan
  var x = event.clientX;
  var y = event.clientY;
  // Panggil fungsi yang akan dieksekusi saat klik kanan
  var currWidth = GFG.clientWidth;
  GFG.style.width = (currWidth - 20) + "px";
});
}
const NewAdmin = (value, username) => {
$areabalas.append('  <div class="message-box-holder">' + '<div class="message-receive">' + username + '</div>' + '<div class="message-box">' + value + '</div></div>')
}
const Submit_Pesan = () => {
var isipesan = $("#pesan").val();
var idS = $("#socketID").val();
var idAdmin = $("#socketIDAdmin").val();
var username = $("#username").val();
// Membuat objek Date baru
var sekarang = new Date();
// Mengambil informasi waktu
var tahun = sekarang.getFullYear(); // Tahun empat digit (contoh: 2023)
var bulan = (sekarang.getMonth() + 1).toString().padStart(2, '0'); // Bulan (0 - 11, tambahkan 1 untuk mendapatkan bulan 1 - 12)
var tanggal = sekarang.getDate(); // Tanggal (1 - 31)
var jam = sekarang.getHours(); // Jam (0 - 23)
var menit = sekarang.getMinutes(); // Menit (0 - 59)
var detik = sekarang.getSeconds(); // Detik (0 - 59)
// Membuat format waktu
var formatWaktu = tahun + '-' + bulan + '-' + tanggal + ' ' + jam + ':' + menit + ':' + detik;
if (idAdmin == "") {
  alert("Admin Belum Ready ");
  return false;
}
socket.emit('message', isipesan, idAdmin, roomsID);
$areapesan.append('<div class="message-box-holder">' +
'<div style="display:inline-block;" >' +
'<img style="float:right;" class="avatar_img" src="https://cdn-icons-png.flaticon.com/128/4333/4333609.png">' +
'<div   style="display:inline-block;">' +
'<span class="span_avatar">' + username +
'</span>' + '<div style="margin-bottom:15px;">' + formatWaktu +
'</div>' +
'</div>'+
'</div>'+
'<div class="message-box">' + isipesan +
'</div>' +
'</div>');
$("#pesan").val("");
}

function getUnreadMessage(username, idsocket) {
var url = "https://pertalis.com/chat_apps/Admin/api/get_unreadmessageuser.php?username=" + username + "&id=" + idsocket;
$.getJSON(url, function(data) {
  $.each(data.result, function() {
    $("#jmlhchat").html(this['jumlah']);
  });
});
}

function get_history(username, idS) {
var idAdmin = $("#socketIDAdmin").val();
var url = "https://pertalis.com/chat_apps/Admin/api/get_history.php?username=" + username + "&rooms=" + roomsID + "&idS=" + idS + "&idAdmin=" + idAdmin;
console.log(url);
$.getJSON(url, function(data) {
  $areapesan.empty();
  $.each(data.result, function() {
    if (this['username_send'] == "admin") {
      if (this['type'] == "text") {
        $areapesan.append('  <div class="message-box-holder">' + '<div  class="message-sender">' + '<img style="float:left;" class="avatar_img_admin" src="https://cdn-icons-png.flaticon.com/128/2343/2343177.png">' + '<div  style="display:block;width:350px;">' + '<span class="span_avatar">Admin</span>' + '</div>' + this['time'] + '</div>' + '<div class="message-box message-partner">' + this['value'] + '</div>' + '</div>');
      }
      else {
        $areapesan.append('  <div class="message-box-holder">' + '<div  class="message-sender">' + '<img style="float:left;" class="avatar_img_admin" src="https://cdn-icons-png.flaticon.com/128/2343/2343177.png">' + '<div  style="display:block;width:350px;">' + '<span class="span_avatar">Admin</span>' + '</div>' + this['time'] + '</div>' + '<div class="message-box message-partner">' + '<p><img  id="' + this['value'] + '" style="width:100%;border-radius:20px;" src="' + this['value'] + '"><p>' + '<p>' + this['caption'] + '</p>' + '</div>' + '</div>');
      }
    }
    else {
      if (this['type'] == "text") {
        $areapesan.append('<div class="message-box-holder">' +
         '<div   style="display:inline-block;">' +
        '<img style="float:right;" class="avatar_img" src="https://cdn-icons-png.flaticon.com/128/4333/4333609.png">' +
        '<div   style="display:inline-block;">' +
        '<span class="span_avatar">' + this['username_send'] + '</span>' +
        '<div style="margin-bottom:15px;">' + this['time'] + '</div>' +
        '</div>' +
        '</div>'+
        '<div class="message-box ">' + this['value'] +
        '</div>' +
        '</div>');
      }
      else {
        $areapesan.append('<div class="message-box-holder">' + '<div   class="message-receive">' + '<img style="float:right;" class="avatar_img" src="https://cdn-icons-png.flaticon.com/128/4333/4333609.png">' + '<div style="display:block;width:165px;">' + '<span  class="span_avatar">' + this['username_send'] + '</span>' + '</div>' + this['time'] + '</div>' + '<div class="message-box">' + '<p><img id="' + this['value'] + '" style="width:100%;" src="' + this['value'] + '"><p>' + '<p>' + this['caption'] + '</p>' + '</div>' + '</div>');
      }
    }
  });
}).done(function(json) {
  $(".chat-messages").LoadingOverlay("hide");
}).fail(function(jqxhr, textStatus, error) {
  alert("Error", "Segera Periksa Internet Anda !", 'error');
});
}

function validation() {
var validasiHuruf = /^[a-zA-Z]+$/;
var nama = document.getElementById("username");
if (nama.value.match(validasiHuruf)) {
  console.log("Nama Anda adalah " + nama.value);
}
else {
  alert("Masukkan nama Anda !\nFormat wajib huruf !\nTidak Perlu Menggunakan SPASI !");
  nama.value = "";
  nama.focus();
  return false;
}
}
//Memvalidasi Extensi Upload
function validasiEkstensi() {
var idS = $("#socketID").val();
var inputFile = document.getElementById('fileid');
var pathFile = inputFile.value;
var ekstensiOk = /(\.jpg|\.jpeg|\.png|\.gif)$/i;
if (!ekstensiOk.exec(pathFile)) {
  alert('Silakan upload file Gambar !');
  inputFile.value = '';
  return false;
}
else {
  var base = $("#Base64IMG").val();
  if (base == "") {
    ChangeForm();
  }
  else {
    openPopup();
  }
}
}
//Untuk Open File
function openFILE() {
document.getElementById('fileid').click();
}

function ChangeForm() {
const docs = $('#fileid').prop('files')[0];
var base64 = getBase64(docs);
handleFile(docs);
openPopup();
}
//Merubah Image Menjadi Base 64
function getBase64(file) {
var reader = new FileReader();
reader.readAsDataURL(file);
reader.onload = function() {
  // console.log(reader.result);
  $("#Base64IMG").val(reader.result);
};
reader.onerror = function(error) {
  console.log('Error: ', error);
};
}
//Upload File
function uploadFile(idS) {
$('#uploadfile').bind('change', function(e) {
  var data = e.originalEvent.target.files[0];
  readThenSendFile(data, idS);
});
}
//Merubah File Menjadi View Canvas
function handleFile(file) {
var canvas = document.getElementById('our-canvas'),
  context = canvas.getContext('2d');
var ImageType = /image.*/;
if (file.type.match(ImageType)) {
  var reader = new FileReader();
  reader.onloadend = function(event) {
    var tempImageStore = new Image();
    tempImageStore.onload = function(ev) {
      canvas.height = ev.target.height;
      canvas.width = ev.target.width;
      context.drawImage(ev.target, 0, 0);
    }
    tempImageStore.src = event.target.result;
  }
  reader.readAsDataURL(file);
}
// openPopup();
}
// Fungsi untuk membuka popup
function openPopup() {
var popup = document.getElementById('popup');
// var openPopupBtn = document.getElementById('openPopup');
popup.classList.add('show');
$("#wa_class").css("display", "block");
$('.click-show').css("display", "block");
$("#displaychat").css("display", "none");
}
// Fungsi untuk menutup popup
function closePopup() {
var popup = document.getElementById('popup');
$("#Base64IMG").val('');
popup.classList.remove('show');
$('.click-show').css("display", "none");
$("#wa_class").css("display", "none");
$("#displaychat").css("display", "block");
}

function send_img() {
var idS = $("#socketIDAdmin").val();
var base64 = $("#Base64IMG").val();
var caption = $("#caption_img").val();
var sock = $("#socketID").val();
var username = $("#username").val();
socket.emit('send_img', base64, idS, caption, roomsID);
let current = new Date();
let cDate = current.getFullYear() + '-' + (current.getMonth() + 1) + '-' + current.getDate();
let cTime = current.getHours() + ":" + current.getMinutes() + ":" + current.getSeconds();
let dateTime = cDate + ' ' + cTime;
$areapesan.append('<div class="message-box-holder">' + '<div   class="message-receive">' + '<img style="float:right;" class="avatar_img" src="https://cdn-icons-png.flaticon.com/128/4333/4333609.png">' + '<div style="display:block;width:165px;">' + '<span  class="span_avatar">' + username + '</span>' + '</div>' + dateTime + '</div>' + '<div class="message-box">' + '<p><img style="width:100%;" src="' + base64 + '"><p>' + '<p>' + caption + '</p>' + '</div>' + '</div>');
$("#Base64IMG").val('');
$("#caption_img").val('');
closePopup();
}

function bunyi() {
var bel = new Audio();
bel.src = 'https://github.com/indriyani13/chat/blob/main/new/smile.ogg';
bel.play();
}
